{% extends "helpdesk/base.html" %}
{% load i18n %}
{% load url from future %}
{% load helpdesk_tables %}
{% block helpdesk_title %}
	{{ helpdesk_settings.HELPDESK_PREPEND_ORG_NAME|default:'' }} {% trans "Helpdesk Dashboard" %}
{% endblock %}

{% block helpdesk_body %}
	<div class="row">
		<div class="col-sm-6">
			<div id="dashboard_summary" class="panel panel-default">
				<div class="panel-heading">{% trans "Helpdesk Summary" %}</div>			
  			<table class="table table-striped">
					<thead>
						<tr>
							<th>{% trans "Queue" %}</th>
							<th class="text-center">{% trans "Open" %}</th>
							<th class="text-center">{% trans "Resolved" %}</th>
							<th class="text-center">{% trans "Closed" %}</th>
						</tr>
					</thead>
					<tbody>
					{% for queue in dash_tickets %}
						<tr class="table-hover">
							<td>
								<a href="{% url 'helpdesk_list' %}?queue={{ queue.queue }}&status=1&status=2">{{ queue.name }}</a>
							</td><td class="text-center">
								{% if queue.open %}
									<a href="{% url 'helpdesk_list' %}?queue={{ queue.queue }}&status=1&status=2">
								{% endif %}
								{{ queue.open }}
								{% if queue.open %}
									</a>
								{% endif %}
							</td><td class="text-center">
								{% if queue.resolved %}
									<a href="{% url 'helpdesk_list' %}?queue={{ queue.queue }}&status=3">
								{% endif %}
								{{ queue.resolved }}
								{% if queue.resolved %}
									</a>
								{% endif %}
							</td><td align="center">
								{% if queue.closed %}
									<a href="{% url 'helpdesk_list' %}?queue={{ queue.queue }}&status=4">
								{% endif %}
								{{ queue.closed }}
								{% if queue.closed %}
									</a>
								{% endif %}
							</td>
						</tr>
					{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		<div class="col-sm-6">
			<div id="dashboard_welcome" class="well">
				{% if helpdesk_settings.HELPDESK_CUSTOM_WELCOME %}
					<p>
						{% trans "Welcome to your Helpdesk Dashboard! From here you can quickly see tickets submitted by you, tickets you are working on, and those tickets that have no owner." %}
					</p>
				{% else %}
					<p>
						{% trans "Welcome to your Helpdesk Dashboard! From here you can quickly see your own tickets, and those tickets that have no owner. Why not pick up an orphan ticket and sort it out for a customer?" %}
					</p>
				{% endif %}
			</div>
		</div>
		{% if helpdesk_settings.HELPDESK_DASHBOARD_BASIC_TICKET_STATS %}
			<div class="col-sm-6">
				<div id="dashboard_stats" class="panel panel-default">
					<div class="panel-heading">{% trans "Current Ticket Stats" %}</div>			
					<ul class="list-group">
  						<li class="list-group-item">
    						<span class="badge">
    							{{ basic_ticket_stats.average_nbr_days_until_ticket_closed }}
    						</span>
    						{% trans 'Average number of days until ticket is closed (all tickets)' %}
  						</li>
  						<li class="list-group-item">
    						<span class="badge">
    							{{ basic_ticket_stats.average_nbr_days_until_ticket_closed_last_60_days }}
    						</span>
    						{% trans 'Average number of days until ticket is closed (tickets opened in last 60 days)' %}
							<small>{% trans "Click" %} <strong><a href="{% url 'helpdesk_report_index' %}daysuntilticketclosedbymonth">here</a></strong> {% trans "for detailed average by month." %}</small>
  						</li>
					</ul>
					<div class="panel-body">
		  				<table class="table table-condensed">
							<thead>
								<tr>
									<th class="text-center" colspan="2">
			  							{% trans "Distribution of open tickets, grouped by time period" %}
			  						</th>
			  					</tr>
								<tr>
									<th>{% trans 'Days since opened' %}</th>
									<th class="text-center">{% trans 'Number of open tickets' %}</th>
								</tr>
							</thead>
							<tbody>
								{% for entry in basic_ticket_stats.open_ticket_stats %}
									<tr>
										<td>{{ entry.0 }}</td>
										<td class="text-center">
											<span style="color: {{ entry.2 }};">
												{% if entry.1 > 0 %}
													<a href="{% url 'helpdesk_list' %}?{{ entry.3 }}">
														{{ entry.1 }}
													</a>
												{% else %}
													{{ entry.1 }}
												{% endif %}
											</span>
										</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		{% endif %} 
	</div>

{% if all_tickets_reported_by_current_user %}
	<div class="row">
		<div class="col-sm-12">
			<div id="dashboard_reported" class="panel panel-default">
				<div class="panel-heading">{% trans "All Tickets submitted by you" %}</div>			
  			<table class="table table-striped">
					<thead>
						<tr>
							<th class="col-sm-1">#</th>
							<th class="col-sm-1">{% trans 'Pr' %}</th>
							<th class="col-sm-5">{% trans 'Title' %}</th>
							<th class="col-sm-2">{% trans 'Queue' %}</th>
							<th class="col-sm-1">{% trans 'Status' %}</th>
							<th class="col-sm-2">{% trans 'Last Update' %}</th>
						</tr>
					</thead>
					<tbody>
						{% for ticket in all_tickets_reported_by_current_user %}
							<tr class='table-hover'>
								<td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.ticket }}</a></td>
								<td>{{ ticket.get_priority_span }}</td>
								<td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.title }}</a></td>
								<td>{{ ticket.queue }}</td>
								<td>{{ ticket.get_status }}</td>
								<td><span title='{{ ticket.modified|date:"r" }}'>{{ ticket.modified|timesince }}</span></td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
	</div>
{% endif %}

	<div class="row">
		<div class="col-sm-12">
			<div id="dashboard_open" class="panel panel-default">
				<div class="panel-heading">{% trans 'Open Tickets assigned to you (you are working on this ticket)' %}</div>		
		    <table class="table table-striped">
					<thead>
						<tr>
							<th class="col-sm-1">#</th>
							<th class="col-sm-1">{% trans 'Pr' %}</th>
							<th class="col-sm-5">{% trans 'Title' %}</th>
							<th class="col-sm-2">{% trans 'Queue' %}</th>
							<th class="col-sm-1">{% trans 'Status' %}</th>
							<th class="col-sm-2">{% trans 'Last Update' %}</th>
						</tr>
					</thead>
					<tbody>
						{% for ticket in user_tickets %}
							<tr class='table-hover'>
								<td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.ticket }}</a></td>
								<td>{{ ticket.get_priority_span }}</td>
								<td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.title }}</a></td>
								<td>{{ ticket.queue }}</td>
								<td>{{ ticket.get_status }}</td>
								<td><span title='{{ ticket.modified|date:"r" }}'>{{ ticket.modified|timesince }}</span></td>
							</tr>
						{% endfor %}
						{% if not user_tickets %}
							<tr><td colspan='5'>{% trans "You have no tickets assigned to you." %}</td></tr>
						{% endif %}
					</tbody>
				</table>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-sm-12">
			<div id="dashboard_unassigned" class="panel panel-default">
				<div class="panel-heading">{% trans 'Unassigned Tickets' %} {% trans '(pick up a ticket if you start to work on it)' %}</div>		
		    <table class="table table-striped">
					<thead>
						<tr>
							<th class="col-sm-1">#</th>
							<th class="col-sm-1">{% trans 'Pr' %}</th>
							<th class="col-sm-5">{% trans 'Title' %}</th>
							<th class="col-sm-2">{% trans 'Queue' %}</th>
							<th class="col-sm-2">{% trans 'Created' %}</th>
							<th class="col-sm-1">&nbsp;</th>
						</tr>
					</thead>
					<tbody>
						{% for ticket in unassigned_tickets %}
							<tr class='table-hover'>
								<td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.ticket }}</a></td>
								<td>{{ ticket.get_priority_span }}</td>
								<td><a href='{{ ticket.get_absolute_url }}'>{{ ticket.title }}</a></td>
								<td>{{ ticket.queue }}</td>
								<td><span title='{{ ticket.created|date:'r' }}'>{{ ticket.created|timesince }} ago</span></td>
								<td>
									<a href='{{ ticket.get_absolute_url }}?take'>
									  <span class="button button_take">{% trans 'Take' %}</span>
									</a> 
									{% if helpdesk_settings.HELPDESK_DASHBOARD_SHOW_DELETE_UNASSIGNED %}
										| <a href='{% url 'helpdesk_delete' ticket.id %}'><span class='button button_delete'>{% trans "Delete" %}</span></a>
									{% endif %}
								</td>
							</tr>
						{% endfor %}
						{% if not unassigned_tickets %}
							<tr><td colspan='6'>{% trans "There are no unassigned tickets." %}</td></tr>
						{% endif %}
					</tbody>
				</table>
			</div>
		</div>
	</div>

	{% if user_tickets_closed_resolved %}
		<div class="row">
			<div class="col-sm-12">
				<div id="dashboard_closed" class="panel panel-default">
					<div class="panel-heading">{% trans 'Closed & resolved Tickets you used to work on' %}</div>		
			    <table class="table table-striped">
						<thead>
							<tr>
								<th class="col-sm-1">#</th>
								<th class="col-sm-1">{% trans 'Pr' %}</th>
								<th class="col-sm-5">{% trans 'Title' %}</th>
								<th class="col-sm-2">{% trans 'Queue' %}</th>
								<th class="col-sm-1">{% trans 'Status' %}</th>
								<th class="col-sm-2">{% trans 'Last Update' %}</th>
							</tr>
						</thead>
						<tbody>
							{% for ticket in user_tickets_closed_resolved %}
								<tr class="table-hover">
									<td><a href="{{ ticket.get_absolute_url }}">{{ ticket.ticket }}</a></td>
									<td>{{ ticket.get_priority_span }}</td>
									<td><a href="{{ ticket.get_absolute_url }}">{{ ticket.title }}</a></td>
									<td>{{ ticket.queue }}</td>
									<td>{{ ticket.get_status }}</td>
									<td><span title="{{ ticket.modified|date:'r' }}">{{ ticket.modified|timesince }}</span></td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	{% endif %}

{% endblock %}
